<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avalon Game</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f7f7;
      direction: rtl;
    }
    h2, h3 { margin: 16px 0 8px; }
    .hidden { display: none; }
    .center { text-align: center; }
    button {
      background-color: #2196f3;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover { background-color: #1976d2; }
    label { display: block; margin-bottom: 8px; }
    input[type="number"], select {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      font-size: 16px;
      background: white;
      color: black;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #resetGame { background-color: #f44336; }
    #roleInfoModal {
      position: fixed;
      top: 0; right: 0; bottom: 0; left: 0;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
    }
    #roleInfoContent {
      background: white;
      padding: 20px;
      max-width: 800px;
      margin: 50px auto;
      border-radius: 10px;
      position: relative;
      direction: rtl;
      overflow-y: auto;
      max-height: 90vh;
    }
    #roleInfoContent table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    #roleInfoContent th, #roleInfoContent td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: right;
    }
    #roleInfoContent th {
      background: #eee;
    }
    .close-btn {
      position: absolute;
      left: 10px;
      top: 10px;
      background: transparent;
      border: none;
      font-size: 24px;
      color: #444;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="setup">
  <button onclick="showRoleInfo()">๐ ูุนุฑู ููุดโูุง</button>
  <label>ฺูุฏ ููุฑ ูุณุชุฏุ <input type="number" id="playerCount" min="7" max="12" value="10"></label>
  <h2>ููุดโูุง ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:</h2>
  <label><input type="checkbox" value="Merlin" checked>ูุฑูู ๐ฆ </label>
  <label><input type="checkbox" value="Mordred" checked>ููุฑุฏุฑุฏ ๐ฅ</label>
  <label><input type="checkbox" value="Assassin" checked>ูุงุชู ๐ฅ</label>
  <label><input type="checkbox" value="Morgana" checked>ููุฑฺฏุงูุง ๐ฅ</label>
  <label><input type="checkbox" value="Oberon" checked>ุงูุจุฑูู ๐ฅ</label>
  <label><input type="checkbox" value="Percival" checked>ูพุฑุณูุงู ๐ฆ</label>
  <h3>ุชุนุฏุงุฏ ุฎุฏูุชฺฉุงุฑูุง ุขุฑุชูุฑ: ๐ฆ</h3>
  <input type="number" id="arthurCount" min="1" value="4">
  <h3>ุชุนุฏุงุฏ ุงุฑุงู ููุฑุฏุฑุฏ: ๐ฅ</h3>
  <input type="number" id="mordredMinionsCount" min="0" value="0">
  <button onclick="startGame()">ุดุฑูุน ุจุงุฒ</button>
</div>

<!-- Modal ูุนุฑู ููุดโูุง -->
<div id="roleInfoModal" class="hidden">
  <div id="roleInfoContent">
    <button class="close-btn" onclick="closeRoleInfo()">ร</button>
    <h2>๐ ูุนุฑู ููุดโูุง ุฏุฑ ุจุงุฒ ุขูุงููู</h2>

    <h3>๐ฆ ุฌูุงุญ ุฎุฑ</h3>
    <ul>
      <li><strong>ูุฑูู:</strong> ููุช ูููโ ุงูุฑุงุฏ ุดุฑ (ุจู ุฌุฒ ููุฑุฏุฑุฏ) ุฑุง ูโุฏุงูุฏ. ูุจุงุฏ ูุงุด ุดูุฏ.</li>
      <li><strong>ูพุฑุณูุงู:</strong> ูโุฏุงูุฏ ฺฉ ุงุฒ ุฏู ููุฑ ูุฑูู ุงุณุช. ุจุงุฏ ุงุฒ ุงู ูุญุงูุธุช ฺฉูุฏ.</li>
      <li><strong>ุฎุฏูุชฺฉุงุฑ ููุงุฏุงุฑ ุขุฑุชูุฑ:</strong> ููุด ุณุงุฏูุ ุจุฏูู ุงุทูุงุนุงุช ุฎุงุต.</li>
    </ul>

    <h3>๐ฅ ุฌูุงุญ ุดุฑ</h3>
    <ul>
      <li><strong>ููุฑุฏุฑุฏ:</strong> ูุฑูู ุงู ุฑุง ููโุจูุฏ. ุนุถู ุดุฑ ูุฎู.</li>
      <li><strong>ููุฑฺฏุงูุง:</strong> ุฎูุฏุด ุฑุง ุดุจู ูุฑูู ูุดุงู ูโุฏูุฏ ุชุง ูพุฑุณูุงู ุฑุง ฺฏูุฑุงู ฺฉูุฏ.</li>
      <li><strong>ูุงุชู:</strong> ุงฺฏุฑ ุฎุฑูุง ุจุจุฑูุฏุ ูุฑูู ุฑุง ุจฺฉุดุฏุ ุดุฑูุง ูพุฑูุฒูุฏ.</li>
      <li><strong>ุงูุจุฑูู:</strong> ุนุถู ุดุฑ ฺฉู ููุช ุฏฺฏุฑุงู ุฑุง ููโุฏุงูุฏ ู ุขูโูุง ูุฒ ุงู ุฑุง ููโุดูุงุณูุฏ.</li>
    </ul>

    <h3>๐ค ุณุงูุงูุชุง</h3>
    <p>ุฏุฑ ูุณุฎูโูุง ุบุฑุฑุณู ุญุถูุฑ ุฏุงุฑุฏ. ุฏุฑ ุดุจ ูโุชูุงูุฏ ุฌูุงุญ ฺฉ ุงุฒ ุจุงุฒฺฉูุงู ุฑุง ุจูพุฑุณุฏ (ุฎุฑ ุง ุดุฑ).</p>

    <h3>๐ ุดุจ ุจุงุฒ</h3>
    <table>
      <thead>
      <tr><th>ููุด</th><th>ฺู ฺฉุณ ุฑุง ูโุจูุฏุ</th><th>ุชูุณุท ฺู ฺฉุณ ุฏุฏู ูโุดูุฏุ</th></tr>
      </thead>
      <tbody>
      <tr><td>ูุฑูู</td><td>ุชูุงู ุดุฑูุฑูุง (ุจู ุฌุฒ ููุฑุฏุฑุฏ)</td><td>ูพุฑุณูุงู</td></tr>
      <tr><td>ูพุฑุณูุงู</td><td>ูุฑูู ู ููุฑฺฏุงูุง (ูุฑุฏู)</td><td>-</td></tr>
      <tr><td>ุงุฑุงู ุดุฑ</td><td>ููุฏฺฏุฑ ุฑุง (ุงูุจุฑูู ูู)</td><td>ูุฑูู (ุจู ุฌุฒ ููุฑุฏุฑุฏ)</td></tr>
      <tr><td>ููุฑุฏุฑุฏ</td><td>ุงุฑุงู ุดุฑ</td><td>ูุฑูู ููโุจูุฏ</td></tr>
      <tr><td>ููุฑฺฏุงูุง</td><td>ุชู ุดุฑ</td><td>ุจุฑุง ูพุฑุณูุงู ูุซู ูุฑูู ุธุงูุฑ ูโุดูุฏ</td></tr>
      <tr><td>ุงูุจุฑูู</td><td>ูฺโฺฉุณ</td><td>ูฺโฺฉุณ ุงู ุฑุง ููโุจูุฏ</td></tr>
      <tr><td>ุณุงูุงูุชุง</td><td>ฺฉ ููุฑ (ู ุฌูุงุญุด)</td><td>-</td></tr>
      </tbody>
    </table>
    <h3>๐ฐ ุงูุณุงููโ ุขุฑุชูุฑ ู ููุฑูุงูุงู ู ุฎุงูุชฺฉุงุฑุงูุด</h3>
    <p>
      ุฏุฑ ุฏู ุงูุณุงููโูุง ุจุงุณุชุงู ุจุฑุชุงูุงุ ุดุงู ุขุฑุชูุฑ ูพุงุฏุดุงู ูฺฉโููุงุฏ ู ุฏุงุฏฺฏุฑ ุจูุฏ ฺฉู ุจุง ฺฉูฺฉ ูุฑููุ ุฌุงุฏูฺฏุฑ ุฎุฑุฏููุฏ ู ุฑุงุฒุฏุงูุ ยซูุฒ ฺฏุฑุฏยป ุฑุง ุจูุงู ููุงุฏ.
      ูุฑูู ุจุง ุจูุด ูุฑุงุทุจุนโุงุด ุงุฒ ูฺฉ ู ุดุฑ ุขฺฏุงู ุจูุฏุ ุงูุง ููโุชูุงูุณุช ููู ฺุฒ ุฑุง ูุงุด ฺฉูุฏ.
      ุฏุฑ ฺฉูุงุฑุดุ <strong>ูพุฑุณูุงู</strong> ุดูุงููโุง ููุงุฏุงุฑ ุจูุฏ ฺฉู ุจุงุฏ ูุฑูู ุฑุง ุงุฒ ุฎุทุฑ ุฏุดููุงู ูพููุงู ูฺฏู ูโุฏุงุดุช โ ูุฑฺูุฏ ููุฑฺฏุงูุงุ ุงุณุชุงุฏ ูุฑุจุ ุชูุฏุฏ ุจุฒุฑฺฏ ุจูุฏ.

      ุฏุฑ ุณู ุชุงุฑฺฉ ุฏุงุณุชุงูุ <strong>ููุฑุฏุฑุฏ</strong> ุงุณุชุงุฏู ุจูุฏุ ูุฑุฒูุฏ ูุงูุดุฑูุน ุดุงู ุขุฑุชูุฑ ู ุฎูุงูุฑ ูุงุชูโุงุด ููุฑฺฏุงูุง.
      ุงู ุชุฌุณู ุฎุงูุช ุจูุฏุ ฺฉุณ ฺฉู ุชูุฏุฑุด ุฏุฑ ุณููุท ูพุงุฏุดุงู ุฑูู ุฎูุฑุฏู ุจูุฏ.
      <Strong>ููุฑฺฏุงูุง</strong>ุ ุฌุงุฏูฺฏุฑ ู ุฒู ุฏูฺูุฑูโุง ุจูุฏ ฺฉู ูุงู ูฺฉ ู ุดุฑ ุฏุฑ ููุณุงู ุจูุฏ ู ููุงุจโูุง ุฑุง ุงุณุชุงุฏุงูู ุจู ฺูุฑู ูโุฒุฏ.
      ุฏุฑ ุณุงูโูุงุ <strong>ุงูุจุฑูู</strong>ุ ููุฌูุฏ ูุงุดูุงุฎุชู ู ุฎุงููุดุ ฺูุงู ูพููุงู ุจูุฏ ฺฉู ุญุช ุงุฑุงู ุดุฑ ูุฒ ุงู ุฑุง ููโุดูุงุฎุชูุฏ.
      ู <strong>ุณุงูุงูุชุง</strong>ุ ุดุฎุตุช ูุฑููุฒ ุฏุฑ ูุณุฎูโูุง ุบุฑุฑุณู ุจุงุฒุ ููฺูู ุฒู ูุฑุจูุฏู ุงุณุช ฺฉู ุดุจุงููุ ุฑุงุฒ ุฌูุงุญ ุจุงุฒฺฉู ุฑุง ุฏุฑฺฉ ูโฺฉูุฏ...

      ุงู ุงูุณุงููโูุงุ ูพุงูโฺฏุฐุงุฑ ุฏูุง ุจุงุฒ ุขูุงูููโุงูุฏุ ุฌุง ฺฉู ูฺฉ ู ูพูุฏุ ุฏุฑ ูุงูุจ ุจุงุฒฺฏุฑุงูุ ุจุฑ ุณุฑ ุณุฑููุดุช ูพุงุฏุดุงู ูุจุฑุฏ ูโฺฉููุฏ.
    </p>

  </div>
</div>
<div id="roleReveal" class="hidden center">
  <h2 id="currentPlayer">ููุฑ 1 ุจุฑุง ุฏุฏู ููุด ฺฉูฺฉ ฺฉูุฏ</h2>
  <button onclick="revealRole()">ุฏุฏู ููุด</button>
  <p id="roleDisplay" style="font-size: 22px; margin-top: 20px;"></p>
  <button class="hidden" id="nextPlayerBtn" onclick="nextPlayer()">ูพููุงู ฺฉู ู ุจุฏู ููุฑ ุจุนุฏ</button>
</div>

<div id="votingPhase" class="hidden center">
  <h2 id="missionTitle">ูุฑุญูู ูุฃููุฑุช</h2>
  <label>ุชุนุฏุงุฏ ุจุงุฒฺฉูุงู ูุฃููุฑุช: <input type="number" id="missionSize" min="2" max="5" value="3"></label>
  <button id="startVotingBtn" onclick="startVoting()">ุดุฑูุน ุฑุฃโฺฏุฑ</button>

  <div id="voteContainer" class="hidden">
    <p id="votePrompt"></p>
    <button id="confirmVoteBtn" onclick="confirmReadyToVote()">ุจุงุฒฺฉู ุขูุงุฏู ุฑุฃ ุฏุงุฏู ุงุณุช</button>
    <div id="voteButtons" class="hidden">
      <button onclick="castVote('success')">โ ูููู</button>
      <button onclick="castVote('fail')">โ ุดฺฉุณุช</button>
    </div>
  </div>

  <!-- Samantha Section -->
  <div id="samanthaSection" style="margin-top: 20px;">
    <button id="samanthaBtn" onclick="showSamanthaChoices()">ุณุงูุงูุชุง ๐ค</button>
    <div id="samanthaChoices" class="hidden">
      <button onclick="selectSamantha('ุดูุฑ ๐ฆ')">ุดูุฑ ๐ฆ</button>
      <button onclick="selectSamantha('ูุงูุง ๐ฅ')">ูุงูุง ๐ฅ</button>
    </div>
    <button id="samanthaRevealBtn" class="hidden" onclick="revealSamantha()">ููุงุด ููุด</button>
    <p id="samanthaResult" style="margin-top: 10px;"></p>
    <button id="samanthaResetBtn" class="hidden" onclick="resetSamantha()">ุฑุณุช ุณุงูุงูุชุง</button>
  </div>

  <button id="showResultsBtn" class="hidden" onclick="showResults()">ุฏุฏู ูุชุฌู ูุฃููุฑุช</button>
  <div id="voteResult" style="margin-top: 20px;"></div>
  <button id="nextMissionBtn" class="hidden" onclick="nextMission()">ุดุฑูุน ูุฃููุฑุช ุจุนุฏ</button>
  <button id="endGameBtn" class="hidden" onclick="confirmEndGame()">ูพุงุงู ุจุงุฒ</button>
</div>

<div id="endGame" class="hidden center">
  <h2>ูพุงุงู ุจุงุฒ</h2>
  <p id="playersList" style="white-space: pre-wrap; text-align: right;"></p>
  <button id="resetGame" onclick="resetGame()">ุดุฑูุน ุฏูุจุงุฑู</button>
</div>

<!-- Scripts -->
<script>
  let players = [], currentIndex = 0, votes = [], voteIndex = 0, currentMission = 1, currentVoteLimit = 0;
  let samanthaPick = '';

  function startGame() {
    const count = +document.getElementById('playerCount').value;
    const arthurCount = +document.getElementById('arthurCount').value;
    const evilCount = +document.getElementById('mordredMinionsCount').value;
    const selectedRoles = [...document.querySelectorAll('input[type=checkbox]:checked')].map(c => c.value);
    const fixedRoles = [...selectedRoles];

    while (fixedRoles.filter(r => r === 'Loyal Servant of Arthur').length < arthurCount)
      fixedRoles.push('Loyal Servant of Arthur');
    while (fixedRoles.filter(r => r === 'Minion of Mordred').length < evilCount)
      fixedRoles.push('Minion of Mordred');

    if (fixedRoles.length !== count) return alert('ุชุนุฏุงุฏ ููุดโูุง ุจุง ุชุนุฏุงุฏ ุจุงุฒฺฉู ููโุฎูุงูุฏ');

    players = shuffle(fixedRoles);
    document.getElementById('setup').classList.add('hidden');
    document.getElementById('roleReveal').classList.remove('hidden');
    updatePlayerText();
  }

  function updatePlayerText() {
    document.getElementById('currentPlayer').textContent = `ููุฑ ${currentIndex + 1} ุจุฑุง ุฏุฏู ููุด ฺฉูฺฉ ฺฉูุฏ`;
    document.getElementById('roleDisplay').textContent = '';
    document.getElementById('nextPlayerBtn').classList.add('hidden');
  }

  function revealRole() {
    const role = players[currentIndex];
    const icon = ['Mordred', 'Assassin', 'Morgana', 'Oberon', 'Minion of Mordred'].includes(role) ? '๐ฅ' : '๐ฆ';
    document.getElementById('roleDisplay').textContent = `ููุด ุดูุง: ${role} ${icon}`;
    document.getElementById('nextPlayerBtn').classList.remove('hidden');
  }

  function nextPlayer() {
    currentIndex++;
    if (currentIndex >= players.length) {
      document.getElementById('roleReveal').classList.add('hidden');
      document.getElementById('votingPhase').classList.remove('hidden');
      updateMissionTitle();
      return;
    }
    updatePlayerText();
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startVoting() {
    const missionSize = +document.getElementById('missionSize').value;
    if (!missionSize || missionSize > players.length)
      return alert('ุชุนุฏุงุฏ ุงูุฑุงุฏ ูุฃููุฑุช ูุงูุนุชุจุฑ ุงุณุช');

    votes = []; voteIndex = 0; currentVoteLimit = missionSize;
    document.getElementById('voteContainer').classList.remove('hidden');
    document.getElementById('startVotingBtn').hidden = true;
    document.getElementById('voteResult').textContent = '';
    document.getElementById('showResultsBtn').classList.add('hidden');
    document.getElementById('nextMissionBtn').classList.add('hidden');
    document.getElementById('endGameBtn').classList.add('hidden');
    resetSamantha();
    nextVote();
  }

  function nextVote() {
    document.getElementById('voteButtons').classList.add('hidden');
    document.getElementById('confirmVoteBtn').classList.remove('hidden');
    if (voteIndex < currentVoteLimit)
      document.getElementById('votePrompt').textContent = `ุจุงุฒฺฉู ${voteIndex + 1} ุขูุงุฏู ุฑุฃ ุฏุงุฏู ุงุณุชุ`;
    else {
      document.getElementById('voteContainer').classList.add('hidden');
      document.getElementById('showResultsBtn').classList.remove('hidden');
    }
  }

  function confirmReadyToVote() {
    document.getElementById('confirmVoteBtn').classList.add('hidden');
    document.getElementById('voteButtons').classList.remove('hidden');
  }

  function castVote(result) {
    votes.push(result);
    voteIndex++;
    nextVote();
  }

  function showResults() {
    const failCount = votes.filter(v => v === 'fail').length;
    const successCount = votes.length - failCount;
    document.getElementById('voteResult').textContent = `ูุชุฌู ูุฃููุฑุช: ${successCount} โ ูููู - ${failCount} โ ุดฺฉุณุช`;
    document.getElementById('nextMissionBtn').classList.remove('hidden');
    if (currentMission >= 5) document.getElementById('endGameBtn').classList.remove('hidden');
  }

  function nextMission() {
    currentMission++;
    updateMissionTitle();
    document.getElementById('startVotingBtn').hidden = false;
    document.getElementById('missionSize').value = 3;
    document.getElementById('voteResult').textContent = '';
    document.getElementById('voteContainer').classList.add('hidden');
    document.getElementById('showResultsBtn').classList.add('hidden');
    document.getElementById('nextMissionBtn').classList.add('hidden');
    document.getElementById('endGameBtn').classList.add('hidden');
    resetSamantha();
  }

  function updateMissionTitle() {
    document.getElementById('missionTitle').textContent = `ูุฑุญูู ูุฃููุฑุช ${currentMission}`;
  }

  function confirmEndGame() {
    if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุจุงุฒ ุฑุง ุจู ูพุงุงู ุจุฑุณุงูุฏุ')) {
      document.getElementById('votingPhase').classList.add('hidden');
      document.getElementById('endGame').classList.remove('hidden');
      document.getElementById('playersList').textContent =
              players.map((r, i) => `ุจุงุฒฺฉู ${i + 1}: ${r}`).join('\n');
    }
  }

  function resetGame() {
    location.reload();
  }

  // ุณุงูุงูุชุง
  function showSamanthaChoices() {
    document.getElementById('samanthaBtn').classList.add('hidden');
    document.getElementById('samanthaChoices').classList.remove('hidden');
  }

  function selectSamantha(choice) {
    samanthaPick = choice;
    document.getElementById('samanthaChoices').classList.add('hidden');
    document.getElementById('samanthaRevealBtn').classList.remove('hidden');
  }

  function revealSamantha() {
    document.getElementById('samanthaRevealBtn').classList.add('hidden');
    document.getElementById('samanthaResult').textContent = `ููุด ุณุงูุงูุชุง: ${samanthaPick}`;
    document.getElementById('samanthaResetBtn').classList.remove('hidden');
  }

  function resetSamantha() {
    samanthaPick = '';
    document.getElementById('samanthaBtn').classList.remove('hidden');
    document.getElementById('samanthaChoices').classList.add('hidden');
    document.getElementById('samanthaRevealBtn').classList.add('hidden');
    document.getElementById('samanthaResult').textContent = '';
    document.getElementById('samanthaResetBtn').classList.add('hidden');
  }

  function showRoleInfo() {
    document.getElementById('roleInfoModal').classList.remove('hidden');
  }

  function closeRoleInfo() {
    document.getElementById('roleInfoModal').classList.add('hidden');
  }
</script>
</body>
</html>
