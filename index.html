<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avalon Game</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f7f7;
      direction: rtl;
    }
    h2, h3 { margin: 16px 0 8px; }
    .hidden { display: none; }
    .center { text-align: center; }
    button {
      background-color: #2196f3;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 0;
    }
    button:hover { background-color: #1976d2; }
    label { display: block; margin-bottom: 8px; }
    input[type="number"], select {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      font-size: 16px;
      background: white;
      color: black;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    select option {
      font-size: 16px;
    }
    #resetGame {
      background-color: #f44336;
    }
    @media (max-width: 600px) {
      body { padding: 10px; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
<div id="setup">
  <label>Ú†Ù†Ø¯ Ù†ÙØ± Ù‡Ø³ØªÛŒØ¯ØŸ <input type="number" id="playerCount" min="7" max="12" value="10"></label>


  <h2>Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</h2>
  <label><input type="checkbox" value="Merlin" checked="checked">Ù…Ø±Ù„ÛŒÙ† ğŸŸ¦ </label>
  <label><input type="checkbox" value="Mordred" checked="checked">Ù…ÙˆØ±Ø¯Ø±Ø¯ ğŸŸ¥</label>
  <label><input type="checkbox" value="Assassin" checked="checked">Ù‚Ø§ØªÙ„ ğŸŸ¥</label>
  <label><input type="checkbox" value="Morgana" checked="checked">Ù…ÙˆØ±Ú¯Ø§Ù†Ø§ ğŸŸ¥</label>
  <label><input type="checkbox" value="Oberon" checked="checked">Ø§ÙˆØ¨Ø±ÙˆÙ† ğŸŸ¥</label>
  <label><input type="checkbox" value="Percival" checked="checked">Ù¾Ø±Ø³ÛŒÙˆØ§Ù„ ğŸŸ¦</label>

  <h3>ØªØ¹Ø¯Ø§Ø¯ Ø®Ø¯Ù…ØªÚ©Ø§Ø±Ù‡Ø§ÛŒ Ø¢Ø±ØªÙˆØ±: ğŸŸ¦</h3>
  <input type="number" id="arthurCount" min="1" value="4">

  <h3>ØªØ¹Ø¯Ø§Ø¯ ÛŒØ§Ø±Ø§Ù† Ù…ÙˆØ±Ø¯Ø±Ø¯: ğŸŸ¥</h3>
  <input type="number" id="mordredMinionsCount" min="0" value="0">

  <button onclick="startGame()">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
</div>

<div id="roleReveal" class="hidden center">
  <h2 id="currentPlayer">Ù†ÙØ± 1 Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù†Ù‚Ø´ Ú©Ù„ÛŒÚ© Ú©Ù†Ø¯</h2>
  <button onclick="revealRole()">Ø¯ÛŒØ¯Ù† Ù†Ù‚Ø´</button>
  <p id="roleDisplay" style="font-size: 22px; margin-top: 20px;"></p>
  <button class="hidden" id="nextPlayerBtn" onclick="nextPlayer()">Ù¾Ù†Ù‡Ø§Ù† Ú©Ù† Ùˆ Ø¨Ø¯Ù‡ Ù†ÙØ± Ø¨Ø¹Ø¯ÛŒ</button>
</div>

<div id="votingPhase" class="hidden center">
  <h2 id="missionTitle">Ù…Ø±Ø­Ù„Ù‡ Ù…Ø£Ù…ÙˆØ±ÛŒØª</h2>
  <label>ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ù…Ø£Ù…ÙˆØ±ÛŒØª: <input type="number" id="missionSize" min="2" max="5" value="3"></label>
  <button id="startVotingBtn" onclick="startVoting()">Ø´Ø±ÙˆØ¹ Ø±Ø£ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ</button>
  <div id="voteContainer" class="hidden">
    <p id="votePrompt"></p>
    <button id="confirmVoteBtn" onclick="confirmReadyToVote()">Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ø±Ø£ÛŒ Ø¯Ø§Ø¯Ù† Ø§Ø³Øª</button>
    <div id="voteButtons" class="hidden">
      <button onclick="castVote('success')">âœ… Success</button>
      <button onclick="castVote('fail')">âŒ Fail</button>
    </div>
  </div>
  <button id="showResultsBtn" class="hidden" onclick="showResults()">Ø¯ÛŒØ¯Ù† Ù†ØªÛŒØ¬Ù‡ Ø±Ø£ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ</button>
  <div id="voteResult" style="margin-top: 20px;"></div>
  <button id="nextMissionBtn" class="hidden" onclick="nextMission()">Ø´Ø±ÙˆØ¹ Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø¨Ø¹Ø¯ÛŒ</button>
</div>

<div id="endGame" class="hidden center">
  <h2>Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ</h2>
  <button id="resetGame" onclick="resetGame()">Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
</div>

<script>
  let players = [];
  let currentIndex = 0;
  let votes = [];
  let voteIndex = 0;
  let currentMission = 1;
  let currentVoteLimit = 0;

  function startGame() {
    const count = parseInt(document.getElementById('playerCount').value);
    const arthurCount = parseInt(document.getElementById('arthurCount').value);
    const evilCount = parseInt(document.getElementById('mordredMinionsCount').value);
    const selectedRoles = [...document.querySelectorAll('input[type=checkbox]:checked')].map(c => c.value);

    const fixedRoles = [...selectedRoles];
    while (fixedRoles.filter(r => r === 'Loyal Servant of Arthur').length < arthurCount) {
      fixedRoles.push('Loyal Servant of Arthur');
    }
    while (fixedRoles.filter(r => r === 'Minion of Mordred').length < evilCount) {
      fixedRoles.push('Minion of Mordred');
    }

    if (fixedRoles.length !== count) {
      alert('ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø¨Ø§ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù† Ù†Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯');
      return;
    }

    players = shuffle(fixedRoles);
    document.getElementById('setup').classList.add('hidden');
    document.getElementById('roleReveal').classList.remove('hidden');
    updatePlayerText();
  }

  function updatePlayerText() {
    document.getElementById('currentPlayer').textContent = `Ù†ÙØ± ${currentIndex + 1} Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù†Ù‚Ø´ Ú©Ù„ÛŒÚ© Ú©Ù†Ø¯`;
    document.getElementById('roleDisplay').textContent = '';
    document.getElementById('nextPlayerBtn').classList.add('hidden');
  }

  function revealRole() {
    const role = players[currentIndex];
    const evilRoles = ['Mordred', 'Assassin', 'Morgana', 'Oberon', 'Minion of Mordred'];
    const goodRoles = ['Merlin', 'Percival', 'Loyal Servant of Arthur'];
    let icon = '';
    if (evilRoles.includes(role)) icon = 'ğŸŸ¥';
    if (goodRoles.includes(role)) icon = 'ğŸŸ¦';
    document.getElementById('roleDisplay').textContent = `Ù†Ù‚Ø´ Ø´Ù…Ø§: ${role} ${icon}`;
    document.getElementById('nextPlayerBtn').classList.remove('hidden');
  }

  function nextPlayer() {
    currentIndex++;
    if (currentIndex >= players.length) {
      document.getElementById('roleReveal').classList.add('hidden');
      document.getElementById('votingPhase').classList.remove('hidden');
      updateMissionTitle();
      return;
    }
    updatePlayerText();
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startVoting() {
    const missionSize = parseInt(document.getElementById('missionSize').value);
    if (!missionSize || missionSize > players.length) {
      alert('ØªØ¹Ø¯Ø§Ø¯ Ø§ÙØ±Ø§Ø¯ Ù…Ø£Ù…ÙˆØ±ÛŒØª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
      return;
    }
    votes = [];
    voteIndex = 0;
    currentVoteLimit = missionSize;
    document.getElementById('voteContainer').classList.remove('hidden');
    document.getElementById('startVotingBtn').hidden = true;
    document.getElementById('voteResult').textContent = '';
    document.getElementById('showResultsBtn').classList.add('hidden');
    document.getElementById('nextMissionBtn').classList.add('hidden');
    nextVote();
  }

  function nextVote() {
    document.getElementById('voteButtons').classList.add('hidden');
    document.getElementById('confirmVoteBtn').classList.remove('hidden');
    if (voteIndex < currentVoteLimit) {
      document.getElementById('votePrompt').textContent = `Ø¨Ø§Ø²ÛŒÚ©Ù† ${voteIndex + 1} Ø¢Ù…Ø§Ø¯Ù‡ Ø±Ø£ÛŒ Ø¯Ø§Ø¯Ù† Ø§Ø³ØªØŸ`;
    } else {
      document.getElementById('voteContainer').classList.add('hidden');
      document.getElementById('showResultsBtn').classList.remove('hidden');
    }
  }

  function confirmReadyToVote() {
    document.getElementById('confirmVoteBtn').classList.add('hidden');
    document.getElementById('voteButtons').classList.remove('hidden');
  }

  function castVote(result) {
    votes.push(result);
    voteIndex++;
    nextVote();
  }

  function showResults() {
    const failCount = votes.filter(v => v === 'fail').length;
    const successCount = votes.length - failCount;
    document.getElementById('voteResult').textContent = `Ù†ØªÛŒØ¬Ù‡ Ù…Ø£Ù…ÙˆØ±ÛŒØª: ${successCount} âœ… Ù…ÙˆÙÙ‚ - ${failCount} âŒ Ø´Ú©Ø³Øª`;
    document.getElementById('nextMissionBtn').classList.remove('hidden');
  }

  function nextMission() {
    document.getElementById('startVotingBtn').hidden = false;
    currentMission++;
    if (currentMission > 5) {
      document.getElementById('votingPhase').classList.add('hidden');
      document.getElementById('endGame').classList.remove('hidden');
    } else {
      updateMissionTitle();
      document.getElementById('voteContainer').classList.add('hidden');
      document.getElementById('showResultsBtn').classList.add('hidden');
      document.getElementById('voteResult').textContent = '';
      document.getElementById('missionSize').value = '';
    }
  }

  function updateMissionTitle() {
    document.getElementById('missionTitle').textContent = `Ù…Ø±Ø­Ù„Ù‡ Ù…Ø£Ù…ÙˆØ±ÛŒØª ${currentMission}`;
  }

  function resetGame() {
    location.reload();
  }
</script>
</body>
</html>
